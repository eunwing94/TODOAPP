<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    
    <!-- local CSS -->
    <link rel="stylesheet" href="/public/main.css">

    </head>
    <body>
      <!-- margine left 2, margine y축 3 -->
      <%- include('nav.html') %>  <!-- ejs에서만 가능함 -->

      <h4 class="ml-2 my-3 text-center"><strong>오늘의 할일 목록</strong></h4> 
        <div class="container">
          <ul class="list-group">
            <%
              for(var i=0;i<postsArray.length;i++) {
            %>
            <!-- <li class="list-group-item" data-id="<%= postsArray[i]._id %>" onclick="location.href='./detail/'+'<%= postsArray[i]._id %>'"> -->
            <li class="list-group-item" data-id="<%= postsArray[i]._id %>">
              <a href="./detail/<%= postsArray[i]._id %>">
                <p>글번호 : <%= postsArray[i]._id %></p>
                <h4 class="gotoDetail">할일 : <%= postsArray[i].제목 %></h4>
                <p>마감 : <%=  postsArray[i].날짜 %></p>
              </a>
              <button class="btn btn-danger delete" data-id="<%= postsArray[i]._id %>">삭제</button>            
            </li> 
            <%
              }
            %>

          </ul>
      </div>
    </body>



        <!-- jquery library -->
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>


        <script>
          $('.delete').click(function(e){
              var listNumber = e.target.dataset.id; // e.target은 내가 누른 요소를 뜻함, dataset.id는 숨겨진 data-id
                            
              $.ajax({
                method : 'DELETE',
                url : '/delete',
                data : {_id : listNumber}

              }).done((result)=>{
                // ajax 특성상 새로고침이 되지 않으므로 여기서 삭제 후 동작 코딩
                // 삭제 버튼을 누른 li 요소 제거하는 법
                console.log('삭제 성공!');
                $(this).parent('li').fadeOut(); // $(e.target)과 $(this)는 동일
                
              }).fail((xhr,code,err)=>{
                console.log(xhr,code,err);
              });

            
          });

          // $('.list-group-item').click(function(e){
          //     var listNumber = e.target.dataset.id; // e.target은 내가 누른 요소를 뜻함, dataset.id는 숨겨진 data-id
              
          //     var detailUrl = './detail/'+listNumber;
          //     location.href = detailUrl;
            
          // });

        </script>
    
    
    

    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    
    <!-- <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2" crossorigin="anonymous"></script>
     -->
</html>
